<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000" width="1400" height="1000">
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #333333; stroke-width: 2; }
      .header { fill: #4a90e2; stroke: #2e5c8a; stroke-width: 2; }
      .user { fill: #e8f4f8; stroke: #4a90e2; stroke-width: 2; }
      .blockchain { fill: #f0e6ff; stroke: #7e57c2; stroke-width: 2; }
      .api { fill: #e6f7e6; stroke: #43a047; stroke-width: 2; }
      .oracle { fill: #fff3e0; stroke: #fb8c00; stroke-width: 2; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #333333; }
      .subtitle { font-family: Arial, sans-serif; font-size: 11px; fill: #666666; }
      .label { font-family: Arial, sans-serif; font-size: 10px; fill: #333333; }
      .arrow { stroke: #333333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-label { font-family: Arial, sans-serif; font-size: 9px; fill: #333333; }
      .section-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #333333; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333333" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" class="section-title">EthVaultPQ Architecture - Post-Quantum Secure Ethereum Protocol</text>

  <!-- User Layer -->
  <text x="50" y="70" class="section-title">User Layer</text>

  <!-- Dashboard -->
  <rect x="50" y="90" width="200" height="120" class="user" rx="5"/>
  <text x="150" y="110" text-anchor="middle" class="title">Dashboard (React)</text>
  <text x="150" y="130" text-anchor="middle" class="subtitle">dashboard/src/</text>
  <line x1="60" y1="135" x2="240" y2="135" stroke="#4a90e2" stroke-width="1"/>
  <text x="60" y="150" class="label">• Wallet Creation</text>
  <text x="60" y="165" class="label">• Vesting Management</text>
  <text x="60" y="180" class="label">• Deploy Tab (NEW)</text>
  <text x="60" y="195" class="label">• Network Selection</text>

  <!-- User's Browser/Wallet -->
  <rect x="300" y="90" width="200" height="120" class="user" rx="5"/>
  <text x="400" y="110" text-anchor="middle" class="title">User's Browser</text>
  <text x="400" y="130" text-anchor="middle" class="subtitle">MetaMask / WalletConnect</text>
  <line x1="310" y1="135" x2="490" y2="135" stroke="#4a90e2" stroke-width="1"/>
  <text x="310" y="150" class="label">• Signs Transactions</text>
  <text x="310" y="165" class="label">• Calls API for Proofs</text>
  <text x="310" y="180" class="label">• Submits Proofs On-Chain</text>
  <text x="310" y="195" class="label">• No Private Keys Needed</text>

  <!-- Arrow: Dashboard -> Browser -->
  <path d="M 250 150 L 300 150" class="arrow"/>
  <text x="265" y="145" class="arrow-label">UI</text>

  <!-- Vercel API Layer -->
  <text x="50" y="270" class="section-title">API Layer (Vercel Serverless)</text>

  <!-- ZK Proof API -->
  <rect x="50" y="290" width="250" height="140" class="api" rx="5"/>
  <text x="175" y="310" text-anchor="middle" class="title">/api/prove</text>
  <text x="175" y="330" text-anchor="middle" class="subtitle">api/zk-proof/api/prove.ts</text>
  <line x1="60" y1="335" x2="290" y2="335" stroke="#43a047" stroke-width="1"/>
  <text x="60" y="350" class="label">• Dilithium3 Verification</text>
  <text x="60" y="365" class="label">  (@noble/post-quantum)</text>
  <text x="60" y="380" class="label">• ZK-SNARK Proof Gen</text>
  <text x="60" y="395" class="label">  (snarkjs + Groth16)</text>
  <text x="60" y="410" class="label">• Pure Computation</text>
  <text x="60" y="425" class="label">• No Private Keys</text>

  <!-- Deployment URL -->
  <rect x="350" y="290" width="250" height="70" class="api" rx="5"/>
  <text x="475" y="310" text-anchor="middle" class="title">Production URL</text>
  <line x1="360" y1="315" x2="590" y2="315" stroke="#43a047" stroke-width="1"/>
  <text x="360" y="330" class="label" style="font-size: 9px;">https://zk-proof-bbp3vv35m-</text>
  <text x="360" y="343" class="label" style="font-size: 9px;">valis-quantum.vercel.app</text>
  <text x="360" y="356" class="label">✅ Live &amp; Working</text>

  <!-- Arrow: Browser -> API -->
  <path d="M 400 210 L 175 290" class="arrow"/>
  <text x="300" y="240" class="arrow-label">POST /api/prove</text>
  <text x="300" y="250" class="arrow-label">(msg, sig, pk)</text>

  <!-- Arrow: API -> Browser (proof return) -->
  <path d="M 175 290 L 420 210" class="arrow" stroke-dasharray="5,5"/>
  <text x="320" y="265" class="arrow-label">Returns: {proof, publicSignals}</text>

  <!-- Blockchain Layer -->
  <text x="750" y="70" class="section-title">Blockchain Layer (Tenderly Ethereum TestNet)</text>

  <!-- Smart Contracts Section -->
  <rect x="750" y="90" width="600" height="340" class="blockchain" rx="5"/>
  <text x="1050" y="110" text-anchor="middle" class="title">Smart Contracts (Solidity 0.8.28)</text>
  <line x1="760" y1="115" x2="1340" y2="115" stroke="#7e57c2" stroke-width="1"/>

  <!-- Contract Group 1: Core PQ -->
  <rect x="770" y="130" width="270" height="140" class="box" rx="3"/>
  <text x="905" y="150" text-anchor="middle" class="subtitle" font-weight="bold">Core Post-Quantum</text>
  <text x="780" y="170" class="label">1. PQValidator</text>
  <text x="785" y="183" class="label" style="font-size: 9px;">   • ERC-4337 validator</text>
  <text x="785" y="194" class="label" style="font-size: 9px;">   • NIST ML-DSA/SLH-DSA</text>
  <text x="780" y="210" class="label">2. PQWalletFactory</text>
  <text x="785" y="223" class="label" style="font-size: 9px;">   • CREATE2 deployment</text>
  <text x="785" y="234" class="label" style="font-size: 9px;">   • Multi-source entropy</text>
  <text x="780" y="250" class="label">3. PQVault (ERC-4626)</text>
  <text x="785" y="263" class="label" style="font-size: 9px;">   • Vesting vault</text>

  <!-- Contract Group 2: Oracles -->
  <rect x="1060" y="130" width="270" height="140" class="box" rx="3"/>
  <text x="1195" y="150" text-anchor="middle" class="subtitle" font-weight="bold">Oracle Contracts</text>
  <text x="1070" y="170" class="label">4. ZKProofOracle</text>
  <text x="1075" y="183" class="label" style="font-size: 9px;">   • 0x312D098B64e32ef...053750</text>
  <text x="1075" y="194" class="label" style="font-size: 9px;">   • Request/fulfill pattern</text>
  <text x="1070" y="210" class="label">5. Groth16VerifierReal</text>
  <text x="1075" y="223" class="label" style="font-size: 9px;">   • 0x1b7754689d5bDf...00B0843</text>
  <text x="1075" y="234" class="label" style="font-size: 9px;">   • ~250k gas per proof</text>
  <text x="1070" y="250" class="label">6. QRNG Oracle</text>
  <text x="1075" y="263" class="label" style="font-size: 9px;">   • Quantum RNG</text>

  <!-- Contract Group 3: Testing -->
  <rect x="770" y="280" width="270" height="90" class="box" rx="3"/>
  <text x="905" y="300" text-anchor="middle" class="subtitle" font-weight="bold">Testing Utilities</text>
  <text x="780" y="320" class="label">7. MockERC20</text>
  <text x="785" y="333" class="label" style="font-size: 9px;">   • Test token for vesting</text>
  <text x="780" y="350" class="label">8. PQVaultDemo</text>
  <text x="785" y="363" class="label" style="font-size: 9px;">   • Fast-forward vesting</text>

  <!-- Network Info -->
  <rect x="1060" y="280" width="270" height="90" class="box" rx="3"/>
  <text x="1195" y="300" text-anchor="middle" class="subtitle" font-weight="bold">Network Details</text>
  <text x="1070" y="320" class="label">Network: Tenderly Ethereum</text>
  <text x="1070" y="335" class="label">Block Time: ~12 seconds</text>
  <text x="1070" y="350" class="label">Status: ✅ All Deployed</text>
  <text x="1070" y="365" class="label">Tests: 30/34 passing (88%)</text>

  <!-- Arrow: Browser -> Blockchain -->
  <path d="M 500 150 L 750 200" class="arrow"/>
  <text x="600" y="165" class="arrow-label">1. requestProof()</text>
  <text x="600" y="175" class="arrow-label">   (user signs tx)</text>

  <!-- Arrow: Blockchain -> Browser (event) -->
  <path d="M 750 250 L 500 180" class="arrow" stroke-dasharray="5,5"/>
  <text x="600" y="220" class="arrow-label">2. ProofRequested event</text>

  <!-- Arrow: Browser -> Blockchain (fulfill) -->
  <path d="M 500 160 L 750 220" class="arrow"/>
  <text x="600" y="195" class="arrow-label">3. fulfillProof(proof)</text>
  <text x="600" y="205" class="arrow-label">   (user signs tx)</text>

  <!-- Data Flow Section -->
  <text x="50" y="490" class="section-title">Complete User Flow</text>

  <rect x="50" y="510" width="1300" height="220" class="box" rx="5"/>

  <!-- Step 1 -->
  <circle cx="100" cy="550" r="20" fill="#4a90e2" stroke="#2e5c8a" stroke-width="2"/>
  <text x="100" y="556" text-anchor="middle" fill="white" font-weight="bold" font-size="16">1</text>
  <text x="130" y="540" class="label" font-weight="bold">User Requests Proof</text>
  <text x="130" y="555" class="label" style="font-size: 9px;">• Opens dashboard, connects wallet</text>
  <text x="130" y="567" class="label" style="font-size: 9px;">• Signs transaction: oracle.requestProof(msg, sig, pk)</text>
  <text x="130" y="579" class="label" style="font-size: 9px;">• Pays fee (e.g., 0.001 ETH)</text>
  <text x="130" y="591" class="label" style="font-size: 9px;">• Receives requestId from event</text>

  <!-- Arrow 1->2 -->
  <path d="M 380 560 L 420 560" class="arrow"/>

  <!-- Step 2 -->
  <circle cx="450" cy="550" r="20" fill="#43a047" stroke="#2e7d32" stroke-width="2"/>
  <text x="450" y="556" text-anchor="middle" fill="white" font-weight="bold" font-size="16">2</text>
  <text x="480" y="540" class="label" font-weight="bold">Generate ZK Proof</text>
  <text x="480" y="555" class="label" style="font-size: 9px;">• Browser calls Vercel API</text>
  <text x="480" y="567" class="label" style="font-size: 9px;">• fetch('/api/prove', {msg, sig, pk})</text>
  <text x="480" y="579" class="label" style="font-size: 9px;">• API verifies Dilithium3 (~7ms)</text>
  <text x="480" y="591" class="label" style="font-size: 9px;">• API generates Groth16 proof (~1-2s)</text>
  <text x="480" y="603" class="label" style="font-size: 9px;">• Returns {proof, publicSignals}</text>

  <!-- Arrow 2->3 -->
  <path d="M 730 560 L 770 560" class="arrow"/>

  <!-- Step 3 -->
  <circle cx="800" cy="550" r="20" fill="#7e57c2" stroke="#5e35b1" stroke-width="2"/>
  <text x="800" y="556" text-anchor="middle" fill="white" font-weight="bold" font-size="16">3</text>
  <text x="830" y="540" class="label" font-weight="bold">Submit Proof On-Chain</text>
  <text x="830" y="555" class="label" style="font-size: 9px;">• User signs transaction</text>
  <text x="830" y="567" class="label" style="font-size: 9px;">• oracle.fulfillProof(requestId, proof)</text>
  <text x="830" y="579" class="label" style="font-size: 9px;">• Groth16 verifier validates (~250k gas)</text>
  <text x="830" y="591" class="label" style="font-size: 9px;">• Proof stored on-chain</text>
  <text x="830" y="603" class="label" style="font-size: 9px;">• ProofFulfilled event emitted</text>

  <!-- Arrow 3->4 -->
  <path d="M 1100 560 L 1140 560" class="arrow"/>

  <!-- Step 4 -->
  <circle cx="1170" cy="550" r="20" fill="#fb8c00" stroke="#e65100" stroke-width="2"/>
  <text x="1170" y="556" text-anchor="middle" fill="white" font-weight="bold" font-size="16">✓</text>
  <text x="1200" y="540" class="label" font-weight="bold">Done!</text>
  <text x="1200" y="555" class="label" style="font-size: 9px;">• Dilithium signature verified</text>
  <text x="1200" y="567" class="label" style="font-size: 9px;">• ZK proof validated on-chain</text>
  <text x="1200" y="579" class="label" style="font-size: 9px;">• Post-quantum security achieved</text>
  <text x="1200" y="591" class="label" style="font-size: 9px;">• User maintains full control</text>
  <text x="1200" y="603" class="label" style="font-size: 9px;">• No operator/private keys needed</text>

  <!-- Time estimates -->
  <text x="230" y="645" class="label" fill="#666666">~1s</text>
  <text x="580" y="645" class="label" fill="#666666">~2s</text>
  <text x="930" y="645" class="label" fill="#666666">~12s (block)</text>
  <text x="1050" y="670" text-anchor="middle" class="label" font-weight="bold" fill="#43a047">Total Time: ~15 seconds</text>

  <!-- Key Benefits Section -->
  <text x="50" y="770" class="section-title">Architecture Benefits</text>

  <rect x="50" y="790" width="400" height="180" class="box" rx="5" fill="#e8f5e9"/>
  <text x="250" y="810" text-anchor="middle" class="subtitle" font-weight="bold">✅ Advantages</text>
  <text x="60" y="830" class="label">• <tspan font-weight="bold">Zero Infrastructure:</tspan> No VPS, no operator service</text>
  <text x="60" y="845" class="label">• <tspan font-weight="bold">Zero Private Keys:</tspan> User controls everything</text>
  <text x="60" y="860" class="label">• <tspan font-weight="bold">Zero Monthly Cost:</tspan> Vercel Hobby plan (free)</text>
  <text x="60" y="875" class="label">• <tspan font-weight="bold">Quantum-Resistant:</tspan> NIST FIPS-204 ML-DSA-65</text>
  <text x="60" y="890" class="label">• <tspan font-weight="bold">Gas Efficient:</tspan> 250k gas (vs 50M+ direct)</text>
  <text x="60" y="905" class="label">• <tspan font-weight="bold">ERC-4337 Compatible:</tspan> Account abstraction ready</text>
  <text x="60" y="920" class="label">• <tspan font-weight="bold">Vercel SLA:</tspan> 99.99% uptime guarantee</text>
  <text x="60" y="935" class="label">• <tspan font-weight="bold">Simple Deploy:</tspan> One command: vercel deploy</text>
  <text x="60" y="950" class="label">• <tspan font-weight="bold">Auto-scaling:</tspan> Handles traffic spikes automatically</text>
  <text x="60" y="965" class="label">• <tspan font-weight="bold">Fully Decentralized:</tspan> User-driven architecture</text>

  <rect x="480" y="790" width="440" height="180" class="box" rx="5" fill="#fff3e0"/>
  <text x="700" y="810" text-anchor="middle" class="subtitle" font-weight="bold">🔧 Technical Specifications</text>
  <text x="490" y="830" class="label">• <tspan font-weight="bold">Dilithium3 (ML-DSA-65):</tspan> NIST FIPS-204 compliant</text>
  <text x="490" y="845" class="label">• <tspan font-weight="bold">Signature Size:</tspan> 3,309 bytes</text>
  <text x="490" y="860" class="label">• <tspan font-weight="bold">Public Key Size:</tspan> 1,952 bytes</text>
  <text x="490" y="875" class="label">• <tspan font-weight="bold">Security Level:</tspan> NIST Level 3 (192-bit equivalent)</text>
  <text x="490" y="890" class="label">• <tspan font-weight="bold">ZK System:</tspan> Groth16 (snarkjs)</text>
  <text x="490" y="905" class="label">• <tspan font-weight="bold">Circuit Size:</tspan> 1.2MB R1CS, 1.8MB proving key</text>
  <text x="490" y="920" class="label">• <tspan font-weight="bold">Proof Generation:</tspan> ~1-2 seconds (off-chain)</text>
  <text x="490" y="935" class="label">• <tspan font-weight="bold">Proof Verification:</tspan> ~250k gas (on-chain)</text>
  <text x="490" y="950" class="label">• <tspan font-weight="bold">Framework:</tspan> Foundry (Solidity 0.8.28)</text>
  <text x="490" y="965" class="label">• <tspan font-weight="bold">Libraries:</tspan> @noble/post-quantum, snarkjs</text>

  <rect x="950" y="790" width="400" height="180" class="box" rx="5" fill="#f3e5f5"/>
  <text x="1150" y="810" text-anchor="middle" class="subtitle" font-weight="bold">📊 Test Results</text>
  <text x="960" y="830" class="label">• <tspan font-weight="bold">Off-Chain Tests:</tspan> 16/16 passing (100%)</text>
  <text x="965" y="843" class="label" style="font-size: 9px;">  ✓ Dilithium verification tests</text>
  <text x="965" y="854" class="label" style="font-size: 9px;">  ✓ ZK proof generation tests</text>
  <text x="960" y="870" class="label">• <tspan font-weight="bold">On-Chain Tests:</tspan> 30/34 passing (88%)</text>
  <text x="965" y="883" class="label" style="font-size: 9px;">  ✓ PQWallet: 9/9 (100%)</text>
  <text x="965" y="894" class="label" style="font-size: 9px;">  ✓ PQVault: 7/7 (100%)</text>
  <text x="965" y="905" class="label" style="font-size: 9px;">  ✓ ZKOracle: 5/5 integration (100%)</text>
  <text x="965" y="916" class="label" style="font-size: 9px;">  ⚠ Dilithium: 9/13 (uses oracle pattern)</text>
  <text x="960" y="932" class="label">• <tspan font-weight="bold">Security Audit:</tspan> 20 vulnerabilities fixed</text>
  <text x="965" y="945" class="label" style="font-size: 9px;">  ✓ 7 HIGH, 7 MEDIUM, 6 LOW</text>
  <text x="960" y="961" class="label">• <tspan font-weight="bold">Slither Analysis:</tspan> Zero critical findings</text>

  <!-- Footer -->
  <text x="700" y="995" text-anchor="middle" class="label" fill="#666666">Generated: October 21, 2025 | Status: ✅ Production-Ready for Tenderly Deployment</text>
</svg>
